@Library('libreria')_

pipeline{
    agent any
    stages{
        stage("Git"){
            steps{
                script{
                    git.clone(this, "https://github.com/MartiMarch/formacion-jenkins-caso-de-uso-real.git")
                }
            }
        }
        stage("Maven"){
            steps{
                script{
                    dir("formacion-jenkins-caso-de-uso-real"){
                        maven.commonPhases(this)
                    }
                }
            }
        }
        stage("Docker"){
            steps{
                script{
                    docker.prune(this)
                    docker.createDockerfile(this, "java")
                    docker.printDockerfile(this)
                    docker.build(this, "java")
                }
            }
        }
        stage("Helm"){
            steps{
                script{
                    dir("formacion-jenkins-caso-de-uso-real/helm"){
                        helm.template(this)
                        helm.lint(this)
                        helm.deploy(this)
                    }
                }
            }
        }
    }
}
