@Library('libreria')_

pipeline{
    agent any
    environment{
        TYPE = "java"
        PATH = "formacion-jenkins-caso-de-uso-real"
        GH_URL = "https://github.com/MartiMarch/${env.PATH}.git"
    }
    stages{
        stage("Git"){
            steps{
                script{
                    git.clone(this, env.GH_URL)
                }
            }
        }
        stage("Maven"){
            steps{
                script{
                    dir(PATH){
                        maven.commonPhases(this)
                    }
                }
            }
        }
        stage("Docker"){
            steps{
                script{
                    docker.prune(this)
                    docker.createDockerfile(this, env.TYPE)
                    docker.printDockerfile(this)
                    docker.build(this, env.TYPE)
                }
            }
        }
        stage("Helm"){
            steps{
                script{
                    dir("${PATH}/helm"){
                        helm.template(this)
                        helm.lint(this)
                        helm.deploy(this)
                    }
                }
            }
        }
    }
}
